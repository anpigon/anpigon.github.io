<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="yfKOiBPD8WlKH3NPG_CG1zr4MsCgCG1YVdGKhMS2CKc">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Noto Serif KR:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: true,
    pangu: false,
    algolia: {
      appID: 'YY693DUDAI',
      apiKey: 'db449d453b150820f66e7bc3d4523a17',
      indexName: 'my-hexo-blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '복사',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="안녕하세요. @anpigon입니다.마스터 이더리움(Mastering Ethereum) 책을 보면서 정리한 글입니다. 아직 전체 내용을 다 보지는 못하였습니다. 하지만 궁금한 사항을 댓글로 문의하면, 최대한 답변해드리도록 노력하겠습니다. 책 전체 내용은 깃허브에서 볼 수 있습니다. https:&#x2F;&#x2F;github.com&#x2F;ethereumbook&#x2F;ethereumboo">
<meta property="og:type" content="article">
<meta property="og:title" content="[블록체인] 이더리움(Ethereum) 공부 #3 - 트랜잭션과 서명">
<meta property="og:url" content="https://anpigon.github.io/busy/@anpigon/ethereum-3">
<meta property="og:site_name" content="안피곤님의 블로그">
<meta property="og:description" content="안녕하세요. @anpigon입니다.마스터 이더리움(Mastering Ethereum) 책을 보면서 정리한 글입니다. 아직 전체 내용을 다 보지는 못하였습니다. 하지만 궁금한 사항을 댓글로 문의하면, 최대한 답변해드리도록 노력하겠습니다. 책 전체 내용은 깃허브에서 볼 수 있습니다. https:&#x2F;&#x2F;github.com&#x2F;ethereumbook&#x2F;ethereumboo">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://steemitimages.com/150x0/https://images-na.ssl-images-amazon.com/images/I/51eW3hlp3jL._SX379_BO1,204,203,200_.jpg">
<meta property="article:published_time" content="2018-09-07T00:46:06.000Z">
<meta property="article:modified_time" content="2021-04-21T11:50:30.077Z">
<meta property="article:author" content="안피곤">
<meta property="article:tag" content="블록체인">
<meta property="article:tag" content="이더리움">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://steemitimages.com/150x0/https://images-na.ssl-images-amazon.com/images/I/51eW3hlp3jL._SX379_BO1,204,203,200_.jpg">

<link rel="canonical" href="https://anpigon.github.io/busy/@anpigon/ethereum-3">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>[블록체인] 이더리움(Ethereum) 공부 #3 - 트랜잭션과 서명 | 안피곤님의 블로그</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-20589042-10"></script>
    <script pjax>
      var host = window.location.hostname;
      if (host !== "localhost" || !true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-20589042-10');
      }
    </script>






  
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2365531018407022",
          enable_page_level_ads: false
     });
</script>
  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="안피곤님의 블로그" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">안피곤님의 블로그</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">코딩, 독서, 여행, 영화, 맛집</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>홈</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>태그<span class="badge">139</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>카테고리<span class="badge">25</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>아카이브<span class="badge">325</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>검색
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input" id="search-input"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

  
</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="ko">
    <link itemprop="mainEntityOfPage" href="https://anpigon.github.io/busy/@anpigon/ethereum-3">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/me.jpg">
      <meta itemprop="name" content="안피곤">
      <meta itemprop="description" content="시간이 천천히 갔으면 좋겠다.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="안피곤님의 블로그">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          [블록체인] 이더리움(Ethereum) 공부 #3 - 트랜잭션과 서명
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">작성일</span>

              <time title="Post created: 2018-09-07 09:46:06" itemprop="dateCreated datePublished" datetime="2018-09-07T09:46:06+09:00">2018-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Updated at: 2021-04-21 20:50:30" itemprop="dateModified" datetime="2021-04-21T20:50:30+09:00">2021-04-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%EA%B0%9C%EB%B0%9C-%EC%9D%B4%EC%95%BC%EA%B8%B0/" itemprop="url" rel="index">
                    <span itemprop="name">개발 이야기</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%EA%B0%9C%EB%B0%9C-%EC%9D%B4%EC%95%BC%EA%B8%B0/%EB%B8%94%EB%A1%9D%EC%B2%B4%EC%9D%B8/" itemprop="url" rel="index">
                    <span itemprop="name">블록체인</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="firestore-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/busy/@anpigon/ethereum-3#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="/busy/@anpigon/ethereum-3" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
            <div style="margin-bottom:35px;margin-top:-20px;">
              <!-- 블로그 본문 상단 광고 -->
              <ins class="adsbygoogle"
                  style="display:block"
                  data-ad-client="ca-pub-2365531018407022"
                  data-ad-slot="3390644000"
                  data-ad-format="auto"
                  data-full-width-responsive="true"></ins>
              <script>
                  (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
            </div>

        <p>안녕하세요. @anpigon입니다.</p><div class="pull-right"><img data-src="https://steemitimages.com/150x0/https://images-na.ssl-images-amazon.com/images/I/51eW3hlp3jL._SX379_BO1,204,203,200_.jpg"></div><p><strong>마스터 이더리움(Mastering Ethereum)</strong> 책을 보면서 정리한 글입니다. 아직 전체 내용을 다 보지는 못하였습니다. 하지만 궁금한 사항을 댓글로 문의하면, 최대한 답변해드리도록 노력하겠습니다.</p><blockquote>
<p>책 전체 내용은 깃허브에서 볼 수 있습니다.<br>
<a target="_blank" rel="noopener" href="https://github.com/ethereumbook/ethereumbook">https://github.com/ethereumbook/ethereumbook</a></p>
</blockquote><a id="more"></a>



<hr>
<br>
<p>자바스크립트에서는 <a target="_blank" rel="noopener" href="https://github.com/ethereum/web3.js">web3.js</a>를 사용하여 이더리움 네트워크와 연동한다. 아래와 같이 설치하여 사용한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install web3</span><br></pre></td></tr></table></figure>
<p><br>또는, 브라우저에서 동작하는 경우에는 CDN를 사용한다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="트랜잭션transactions"><a class="markdownIt-Anchor" href="#트랜잭션transactions"></a> 트랜잭션(Transactions)</h1>
<p>**트랜잭션(Transactions)**은 외부 소유 계정(EOA)에서 생성되어 이더리움 블록체인에 기록된 서명된 메시지다. 트랜잭션을 통해서만 이더(ether)를 전송하거나, 이더리움 가상 머신(EVM)에 있는 컨트랙트를 실행 할 수 있다.</p>
<h2 id="트랜잭션의-구조"><a class="markdownIt-Anchor" href="#트랜잭션의-구조"></a> 트랜잭션의 구조</h2>
<p>트랜잭션은 다음과 같은 필드로 구성된다.</p>
<ul>
<li><strong>nonce</strong>: EOA에 발급되는 트랜잭션 일련번호.</li>
<li><strong>gas price</strong>: 가스 가격</li>
<li><strong>gas limit</strong>: 가스의 최대 사용량</li>
<li><strong>to</strong>: 수신자 주소</li>
<li><strong>value</strong>: 수신자에게 보내는 이더(ether) 개수</li>
<li><strong>data</strong>: 가변길이의 바이너리 데이터(payload)</li>
<li><strong>v, r, s</strong>: ECDSA 서명 구성 요소</li>
</ul>
<p>트랜잭션에는 발신자 주소를 의미하는 <strong>from</strong> 필드를 포함하지 않는다. 발신자의 공개키는 ECDSA 서명의 구성요소(v,r,s)에서 계산 할 수 있기 때문이다. 그리고 공개키에서 주소를 계산할 수 있다.<br>
<br></p>
<hr>
<h2 id="nonce"><a class="markdownIt-Anchor" href="#nonce"></a> nonce</h2>
<p><strong>nonce</strong>는 EOA가 생성하여 블록체인에 기록된 트랜잭션 개수이다. nonce는 트랜잭션의 중복 전송을 방지하는데 사용된다.</p>
<p>예를 들면, <em>10 ether</em>를 가지고 있는 계정이 있다. 그리고 이 계정에서 <em>6 ether</em>를 소비하는 두 개의 <code>트랜잭션 nonce 1</code>과 <code>트랜잭션 nonce 2</code>에 서명하여 전송한다. 이더리움 노드는 트랜잭션을 수신한 순서가 아닌 <strong>nonce</strong>의 순서로 처리한다. <code>트랜잭션 nonce 1</code>이 성공적으로 처리되면 계정의 잔액을 <em>4 ether</em>로 줄인다. 그리고 <code>트랜잭션 nonce 2</code>는 잔액이 부족하므로 유효하지 않은 것으로 간주한다. 그러나 <code>트랜잭션 nonce 2</code>가 먼저 수신되면 노드는 이를 유지하고 <code>트랜잭션 nonce 1</code>이 도착할 때 까지 트랜잭션의 유효성을 검사하지 않는다.</p>
<p>아래와 같이 web3를 사용하여 <strong>nonce</strong>를 조회 할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> address = <span class="string">&quot;0x57FC45cc929f84eC95cd6C6903bBcA8d1164d0B3&quot;</span></span><br><span class="line">web3.eth.getTransactionCount(address, <span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>) ｛</span></span><br><span class="line"><span class="function">  <span class="title">console</span>.<span class="title">log</span>(<span class="params">result</span>)</span></span><br><span class="line"><span class="function">｝)</span></span><br></pre></td></tr></table></figure>
<p>새로운 트랜잭션을 생성할 때, 다음 <strong>nonce</strong>를 조회하여 트랜잭션에 포함해야 한다. 그러나 트랜잭션이 블록체인에 기록(채굴)되기 전까지는 <code>getTransactionCount()</code> 함수의 합계에 포함되지 않는다. 그래서 블록체인에 기록되기 전인 pending 상태의 트랜잭션은 프로그램상에서 계산하여 저장하고 있어야 한다.<br>
<br></p>
<hr>
<h2 id="gas-price"><a class="markdownIt-Anchor" href="#gas-price"></a> gas price</h2>
<p>가스(gas)는 이더(ether)와는 별도의 가상 화폐다. 가스는 DDoS 공격이나 악의적으로 자원을 소모하게 하는 트랜잭션을 방지하기 위해 사용된다.</p>
<p>트랜잭션에 포함되는 <strong>gasPrice</strong> 필드는 트랜잭션 생성자가 가스 가격을 설정할 수 있다. 가스 가격은 GWei 단위를 사용한다. 현재 이더리움 네트워크의 가스 정보는 <a target="_blank" rel="noopener" href="https://ethgasstation.info/">ethgasstation.info</a>에서 확인 할 수 있다.</p>
<p>트랜잭션의 가스 가격을 높게 설정하면 블록체인에 더 빨리 기록된다. 설정할 수 있는 최소 가스 가격은 <strong>0</strong>이며, 이것은 수수료가 없는 트랜잭션을 의미한다. 채굴자 입장에서는 보상받을 수 있는 가스비가 높은 순으로 블록체인에 기록하기 때문에, 가스비가 낮은 트랜잭션은 우선순위가 낮을 수밖에 없다.</p>
<p>아래와 같이 web3을 사용하여 이더리움 네트워크 평균 가스 가격을 조회할 수 있다. 이것은 말 그대로 네트워크에서 소비된 가스의 평균 가격이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">web3.eth.getGasPrice(<span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>) ｛</span></span><br><span class="line"><span class="function">  <span class="title">console</span>.<span class="title">log</span>(<span class="params">res.toNumber()</span>)</span></span><br><span class="line"><span class="function">｝)</span></span><br></pre></td></tr></table></figure>
<br>
<hr>
<h2 id="gas-limit"><a class="markdownIt-Anchor" href="#gas-limit"></a> gas limit</h2>
<p>가스와 관련된 두 번째 중요한 값은 <strong>gasLimit</strong>이다. gasLimit는 트랜잭션을 처리하는데 사용할 최대 가스 개수를 설정한다. 단순하게 하나의 EOA에서 다른 EOA로 이더(ether)를 전송하는 트랜잭션에 필요한 가스량은 21,000개로 고정되어 있다. 따라서 이더 전송에 소비되는 수수료를 계산하려면 가스 가격에 21,000를 곱하면 된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">web3.eth.getGasPrice(<span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>) ｛</span></span><br><span class="line"><span class="function">  <span class="title">console</span>.<span class="title">log</span>(<span class="params">res * <span class="number">21000</span></span>)</span></span><br><span class="line"><span class="function">｝)</span></span><br></pre></td></tr></table></figure>
<p>트랜잭션 목적지가 컨트랙트 주소인 경우에는 필요한 가스량을 추정할 수는 있지만 정확하게 계산할 수는 없다. 컨트랙트 호출에 필요한 가스량은 컨트랙트 실행이 완료된 후에 결정된다.</p>
<p>만약 <strong>gasLimit</strong>를 컨트랙트가 실행하는데 필요한 가스량보다 적게 설정한 경우, 컨트랙트는 실행되지 못하고 가스 비용만 소비하게 된다. 대부분은 <strong>gasLimit</strong>를 초과하여 설정한다. 왜냐하면 컨트랙트가 실행되면 실제로 사용된 가스 비용만 차감하기 때문이다. 그리고 <strong>gasLimit</strong>는 잘못된 컨트랙트 호출로 인해 예상치보다 많은 가스 비용을 사용하는 것을 방지해준다.<br>
<br></p>
<hr>
<h2 id="to"><a class="markdownIt-Anchor" href="#to"></a> to</h2>
<p><strong>to</strong> 필드는 수신자(도착지) 주소를 의미한다. 수신자 주소는 EOA 또는 컨트랙트 주소이다. 이더리움 네트워크에서는 주소를 검증하지 않는다. 따라서 잘못된 주소로 전송된 이더는 영원히 사용할 수 없게 된다.<br>
<br></p>
<hr>
<h2 id="value와-data"><a class="markdownIt-Anchor" href="#value와-data"></a> value와 data</h2>
<p>트랜잭션에서 가장 중요한 &quot;payload&quot;는 value와 data라는 두 개의 필드에 의해 사용된다. 트랜잭션은 다음과 같이 네 가지 조합이 가능하다. ‘<em>value와 data 둘다 사용</em>’, ‘<em>value만 사용</em>’, ‘<em>data만 사용</em>’, ‘<em>value와 data 둘다 없음</em>’.</p>
<p>value만 있는 트랜잭션은 <strong>송금(payment)</strong> 이다. 그리고 데이터만 있는 트랜잭션은 **컨트랙트 호출(invocation)**이다. value도 data도 없는 트랜잭션은 그냥 가스 낭비다.</p>
<h2 id="value-전송"><a class="markdownIt-Anchor" href="#value-전송"></a> value 전송</h2>
<p><strong>value</strong>을 포함하는 트랜잭션은 **송금(payment)**이라고 보면 된다. EOA 주소 또는 컨트랙트 주소로 <strong>value</strong>를 포함한 트랜잭션을 전송하면 해당 계정의 ether 잔액에 <strong>value</strong>가 추가된다. 하지만, 이 트랜잭션은 EOA 주소와 컨트랙트 주소에서는 다르게 작동한다.</p>
<p>대상 주소(to)가 컨트랙트 주소인 경우에는 EVM이 컨트랙트를 실행하고 트랜잭션의 data에 지정된 함수를 호출하려고 시도한다. 트랜잭션에 data가 없으면 EVM에서 대상 컨트랙트의 <em>이름없는(fallback)</em> 함수를 호출한다. 그리고 해당 함수가 송금가능(payable)인 경우에는 다음에 수행할 작업을 결정하기 위해 해당 함수를 실행한다. 송금가능(payable) 함수가 성공적으로 실행완료되면 컨트랙트의 ether 잔액에 송금된 금액을 반영하여 컨트랙트 상태가 업데이트된다.</p>
<p>만약 트랜잭션에 <strong>data</strong>가 포함되어 있으면 이 트랜잭션은 컨트랙트 주소로 처리될 가능성이 크다. 트랜잭션에 포함된 데이터는 EVM에 의해 <strong>함수 호출(function invocation)</strong> 로 해석되고 <strong>data</strong>에 지정된 함수가 호출된다.<br>
<br></p>
<hr>
<h2 id="디지털-서명ecdsa-elliptic-curve-digital-signature-algorithm"><a class="markdownIt-Anchor" href="#디지털-서명ecdsa-elliptic-curve-digital-signature-algorithm"></a> 디지털 서명(ECDSA, Elliptic Curve Digital Signature Algorithm)</h2>
<p>이더리움은 디지털 서명에 ECDSA(Elliptic Curve Digital Signature Algorithm) 알고리즘을 사용한다. ECDSA는 타원 곡선 개인/공개키를 기반으로하는 디지털 서명에 사용하는 알고리즘이다. 디지털 서명은 이더 소유를 증명하고 부인 방지하는데 사용된다.</p>
<blockquote>
<p>ECDSA를 더 자세히 알고 싶으면 단계별로 설명해주는 가이드 문서를 참고하세요. <a target="_blank" rel="noopener" href="http://bit.ly/2r0HhGB">http://bit.ly/2r0HhGB</a></p>
</blockquote>
<p><br>이더리움의 서명된 메세지는 RLP로 인코딩된 트랜잭션 데이터의 Keccak256 해시이다. 코드로 나타내면 다음과 같다.</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sig = sign(<span class="name">keccak256</span>(<span class="name">rlp</span>.encode(<span class="name">tx</span>.raw)), privateKey)</span><br></pre></td></tr></table></figure>
<p><br>sign함수는 일반적으로 R과 S값으로 구성된 서명 Sig를 생성한다.</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Sig</span> = (R, S)</span><br></pre></td></tr></table></figure>
<p><br>이더리움 트랜잭션 서명은 다음 순서로 진핸된다.</p>
<ol>
<li>nonce, gasPrice, gasLimit, to, value, data, v, r, s의 9개 필드를 포함하는 트랜잭션 데이터 구조를 만든다.</li>
<li>트랜잭션을 RLP 인코딩하여 serialize한다.</li>
<li>이 serialize 메시지의 Keccak256 해시를 계산한다.</li>
<li>EOA의 개인키로 해시를 ECDSA 서명한다.</li>
<li>ECDSA 서명의 계산된 r과 s값을 트랜잭션에 삽입한다.<br>
<br></li>
</ol>
<hr>
<h2 id="raw-트랜잭션-생성하여-서명하기"><a class="markdownIt-Anchor" href="#raw-트랜잭션-생성하여-서명하기"></a> raw 트랜잭션 생성하여 서명하기</h2>
<p>이더리움 트랜잭션 생성에는 <a target="_blank" rel="noopener" href="https://github.com/ethereumjs/ethereumjs-tx">ethereumjs-tx</a>를 사용한다. 이더리움 트랜잭션을 <strong>생성</strong>하여 <strong>서명</strong>하고 <strong>전송</strong>해 보자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Web3 = <span class="built_in">require</span>(<span class="string">&#x27;web3&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> EthereumTx = <span class="built_in">require</span>(<span class="string">&#x27;ethereumjs-tx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> web3</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">&#x27;undefined&#x27;</span>) ｛</span><br><span class="line">  web3 = <span class="keyword">new</span> Web3(web3.currentProvider)</span><br><span class="line">｝ <span class="keyword">else</span> ｛</span><br><span class="line">  <span class="comment">// Set the provider you want from Web3.providers</span></span><br><span class="line">  web3 = <span class="keyword">new</span> Web3(<span class="keyword">new</span> Web3.providers.HttpProvider(<span class="string">&quot;http://localhost:8545&quot;</span>))</span><br><span class="line">｝</span><br><span class="line"></span><br><span class="line"><span class="comment">// EOA 계정 주소</span></span><br><span class="line"><span class="keyword">const</span> fromAddress = <span class="string">&#x27;0xf6d0B5f612dEecB00345D...&#x27;</span></span><br><span class="line"><span class="keyword">const</span> toAddress = <span class="string">&#x27;0xDf6d0B5d345EecB00f612...&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. nonce 값 조회</span></span><br><span class="line">web3.eth.getTransactionCount(fromAddress, <span class="function"><span class="keyword">function</span>(<span class="params">err, nonce</span>) ｛</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // 2. 트랙잭션 데이터 생성</span></span><br><span class="line"><span class="function">  <span class="title">const</span> <span class="title">txParams</span> = ｛</span></span><br><span class="line"><span class="function">    <span class="title">nonce</span>: <span class="title">web3</span>.<span class="title">toHex</span>(<span class="params">nonce</span>),</span></span><br><span class="line"><span class="function">    <span class="title">to</span>: <span class="title">toAddress</span>,</span></span><br><span class="line"><span class="function">    <span class="title">value</span>: <span class="title">web3</span>.<span class="title">toHex</span>(<span class="params">web3.toWei(<span class="number">0.1</span>, <span class="string">&#x27;ether&#x27;</span>).toNumber()</span>), // 0.1 이더</span></span><br><span class="line"><span class="function">    <span class="title">gasPrice</span>: <span class="title">web3</span>.<span class="title">toHex</span>(<span class="params">web3.toWei(<span class="number">1</span>, <span class="string">&#x27;Gwei&#x27;</span>).toNumber()</span>), // 가스 가격</span></span><br><span class="line"><span class="function">    <span class="title">gasLimit</span>: <span class="title">web3</span>.<span class="title">toHex</span>(<span class="params"><span class="number">300000</span></span>), // 가스 최대 사용량</span></span><br><span class="line"><span class="function">    // <span class="title">EIP</span> 155 <span class="title">chainId</span> - <span class="title">mainnet</span>: 1, <span class="title">ropsten</span>: 3</span></span><br><span class="line"><span class="function">    <span class="title">chainId</span>: 3, //네트워크 <span class="title">ID</span>(<span class="params"><span class="number">3</span>=Ropsten Tesetnet</span>) </span></span><br><span class="line"><span class="function">  ｝</span></span><br><span class="line"><span class="function">  <span class="title">const</span> <span class="title">tx</span> = <span class="title">new</span> <span class="title">EthereumTx</span>(<span class="params">txParams</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // 3. 트랜잭션 서명</span></span><br><span class="line"><span class="function">  <span class="title">const</span> <span class="title">privateKey</span> = <span class="title">Buffer</span>.<span class="title">from</span>(<span class="params"><span class="string">&#x27;91c8360c4cb4b5fac45513a7213f31d4e4a7bfcb4630e9fbf074f42a203ac0b9&#x27;</span>, <span class="string">&#x27;hex&#x27;</span></span>)</span></span><br><span class="line"><span class="function">  <span class="title">tx</span>.<span class="title">sign</span>(<span class="params">privateKey</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // 4. 트랜잭션 전송하기</span></span><br><span class="line"><span class="function">  <span class="title">const</span> <span class="title">serializedTx</span> = &#x27;0<span class="title">x</span>&#x27; + <span class="title">tx</span>.<span class="title">serialize</span>(<span class="params"></span>).<span class="title">toString</span>(<span class="params"><span class="string">&#x27;hex&#x27;</span></span>)</span></span><br><span class="line"><span class="function">  <span class="title">web3</span>.<span class="title">eth</span>.<span class="title">sendRawTransaction</span>(<span class="params">serializedTx, <span class="keyword">function</span>(err, txId) ｛</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">if</span> (!err) ｛</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="built_in">console</span>.log(<span class="string">&#x27;txId: &#x27;</span>, txId) <span class="comment">// 트랜잭션ID값</span></span></span></span><br><span class="line"><span class="function"><span class="params">    ｝</span></span></span><br><span class="line"><span class="function"><span class="params">  ｝</span>)</span></span><br><span class="line"><span class="function">｝)</span></span><br></pre></td></tr></table></figure>
<p><br> 서명 검증이나 공개키 계산은 ethereumjs-tx를 이용하면 아래와 같이 간단하게 처리할 수 있다.</p>
<h6 id="트랜잭션-서명-검증하기"><a class="markdownIt-Anchor" href="#트랜잭션-서명-검증하기"></a> 트랜잭션 서명 검증하기</h6>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (tx.verifySignature()) ｛</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;서명 검증 완료!&#x27;</span>)</span><br><span class="line">｝</span><br></pre></td></tr></table></figure>
<h6 id="서명에서-발신자-주소-계산하기"><a class="markdownIt-Anchor" href="#서명에서-발신자-주소-계산하기"></a> 서명에서 발신자 주소 계산하기</h6>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;발신자 주소: &#x27;</span> + tx.getSenderAddress().toString(<span class="string">&#x27;hex&#x27;</span>))</span><br></pre></td></tr></table></figure>
<br>
<hr>
<h2 id="단순-반복-공격-방지eip-155"><a class="markdownIt-Anchor" href="#단순-반복-공격-방지eip-155"></a> 단순 반복 공격 방지(EIP-155)</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-155.md">EIP-155</a>은 **“단순 반복 공격 방지(Simple Replay Attack Protection)”**를 위한 제안이다. 서명하기 전 트랜잭션 데이터 내부에 체인ID(chain identifier)를 포함한다 . 이렇게하면 하나의 블록체인(메인넷)에서 생성된 트랜잭션이 다른 블록체인(이더리움 클래식 또는 테스트넷)에서 유효하지 않다. 하나의 네트워크에서 브로드 캐스트되는 트랜잭션을 다른 네트워크에서 반복하여 사용할 수 없기 때문에 &quot;반복 공격 보호(replay attack protection)&quot;라고 한다.</p>
<p>EIP-155가 적용된 서명을 코드로 나타내면 아래와 같다.</p>
<h6 id="r-s-v-값-계산하기"><a class="markdownIt-Anchor" href="#r-s-v-값-계산하기"></a> r, s, v 값 계산하기</h6>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> secp256k1 = <span class="built_in">require</span>(<span class="string">&#x27;secp256k1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// EIP 155 chainId - mainnet: 1, ropsten: 3</span></span><br><span class="line"><span class="keyword">const</span> chainId = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> v = chainId</span><br><span class="line">v -= chainId * <span class="number">2</span> + <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Keccak256 hash of the RLP-encoded data</span></span><br><span class="line"><span class="keyword">const</span> msgHash = keccak(rlp.encode(tx.raw))</span><br><span class="line"></span><br><span class="line"><span class="comment">// sign a transaction with a given private key</span></span><br><span class="line"><span class="keyword">const</span> sig = secp256k1.sign(msgHash, privateKey)</span><br><span class="line">sig.r = sig.signature.slice(<span class="number">0</span>, <span class="number">32</span>)</span><br><span class="line">sig.s = sig.signature.slice(<span class="number">32</span>, <span class="number">64</span>)</span><br><span class="line">sig.v = sig.recovery + <span class="number">27</span></span><br><span class="line">sig.v += chainId * <span class="number">2</span> + <span class="number">8</span></span><br></pre></td></tr></table></figure>
<h6 id="r-s-v-값에서-발신자-공개키-계산하기"><a class="markdownIt-Anchor" href="#r-s-v-값에서-발신자-공개키-계산하기"></a> r, s, v 값에서 발신자 공개키 계산하기</h6>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> signature = Buffer.concat([setLength(r, <span class="number">32</span>), setLength(s, <span class="number">32</span>)], <span class="number">64</span>)</span><br><span class="line"><span class="keyword">const</span> recovery = v - <span class="number">27</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> senderPubKey = secp256k1.recover(msgHash, signature, recovery)</span><br><span class="line"><span class="keyword">const</span> senderPubKey =  secp256k1.publicKeyConvert(senderPubKey, <span class="literal">false</span>).slice(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<br>
<p>ECDSA 서명은 너무 복잡하여 제 수학적 머리로는 이해하기 어려웠습니다. 그래서 서명에 관련된 내용은 설명이 많이 부족합니다. 😥</p>
<p>여기까지 읽어주셔서 감사합니다.</p>
<hr>
<p>이전글</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://steemit.com/@anpigon/ethereum-1">이더리움(Ethereum) 공부 #1 - 키와 주소</a></li>
<li><a target="_blank" rel="noopener" href="https://steemit.com/@anpigon/ethereum-2-hd">이더리움(Ethereum) 공부 #2 - HD 지갑과 니모닉 코드</a></li>
</ul>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%EB%B8%94%EB%A1%9D%EC%B2%B4%EC%9D%B8/" rel="tag"># 블록체인</a>
              <a href="/tags/%EC%9D%B4%EB%8D%94%EB%A6%AC%EC%9B%80/" rel="tag"># 이더리움</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/busy/@anpigon/6sns8d" rel="next" title="블록체인 기반 은행 인증서비스 “뱅크사인” 사용후기">
                  <i class="fa fa-chevron-left"></i> 블록체인 기반 은행 인증서비스 “뱅크사인” 사용후기
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/busy/@anpigon/steem-project-1" rel="prev" title="[Steem Project #1] 스팀잇 펫 연구소">
                  [Steem Project #1] 스팀잇 펫 연구소 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          목차
        </li>
        <li class="sidebar-nav-overview">
          흝어보기
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98transactions"><span class="nav-number">1.</span> <span class="nav-text"> 트랜잭션(Transactions)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-%EA%B5%AC%EC%A1%B0"><span class="nav-number">1.1.</span> <span class="nav-text"> 트랜잭션의 구조</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nonce"><span class="nav-number">1.2.</span> <span class="nav-text"> nonce</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gas-price"><span class="nav-number">1.3.</span> <span class="nav-text"> gas price</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gas-limit"><span class="nav-number">1.4.</span> <span class="nav-text"> gas limit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#to"><span class="nav-number">1.5.</span> <span class="nav-text"> to</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#value%EC%99%80-data"><span class="nav-number">1.6.</span> <span class="nav-text"> value와 data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#value-%EC%A0%84%EC%86%A1"><span class="nav-number">1.7.</span> <span class="nav-text"> value 전송</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EB%94%94%EC%A7%80%ED%84%B8-%EC%84%9C%EB%AA%85ecdsa-elliptic-curve-digital-signature-algorithm"><span class="nav-number">1.8.</span> <span class="nav-text"> 디지털 서명(ECDSA, Elliptic Curve Digital Signature Algorithm)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#raw-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%83%9D%EC%84%B1%ED%95%98%EC%97%AC-%EC%84%9C%EB%AA%85%ED%95%98%EA%B8%B0"><span class="nav-number">1.9.</span> <span class="nav-text"> raw 트랜잭션 생성하여 서명하기</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%84%9C%EB%AA%85-%EA%B2%80%EC%A6%9D%ED%95%98%EA%B8%B0"><span class="nav-number">1.9.0.0.0.1.</span> <span class="nav-text"> 트랜잭션 서명 검증하기</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%EC%84%9C%EB%AA%85%EC%97%90%EC%84%9C-%EB%B0%9C%EC%8B%A0%EC%9E%90-%EC%A3%BC%EC%86%8C-%EA%B3%84%EC%82%B0%ED%95%98%EA%B8%B0"><span class="nav-number">1.9.0.0.0.2.</span> <span class="nav-text"> 서명에서 발신자 주소 계산하기</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EB%8B%A8%EC%88%9C-%EB%B0%98%EB%B3%B5-%EA%B3%B5%EA%B2%A9-%EB%B0%A9%EC%A7%80eip-155"><span class="nav-number">1.10.</span> <span class="nav-text"> 단순 반복 공격 방지(EIP-155)</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#r-s-v-%EA%B0%92-%EA%B3%84%EC%82%B0%ED%95%98%EA%B8%B0"><span class="nav-number">1.10.0.0.0.1.</span> <span class="nav-text"> r, s, v 값 계산하기</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#r-s-v-%EA%B0%92%EC%97%90%EC%84%9C-%EB%B0%9C%EC%8B%A0%EC%9E%90-%EA%B3%B5%EA%B0%9C%ED%82%A4-%EA%B3%84%EC%82%B0%ED%95%98%EA%B8%B0"><span class="nav-number">1.10.0.0.0.2.</span> <span class="nav-text"> r, s, v 값에서 발신자 공개키 계산하기</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="안피곤"
    src="/images/me.jpg">
  <p class="site-author-name" itemprop="name">안피곤</p>
  <div class="site-description" itemprop="description">시간이 천천히 갔으면 좋겠다.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">325</span>
          <span class="site-state-item-name">포스트</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">카테고리</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">139</span>
        <span class="site-state-item-name">태그</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/anpigon" title="GitHub &rarr; https://github.com/anpigon" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:markan82@gmail.com" title="E-Mail &rarr; mailto:markan82@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>
          <!-- 정사각형 광고 -->
          <div style="margin-top: 15px;">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-2365531018407022"
                data-ad-slot="7521850306"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </div>
    </div>
  </aside>
  <div id="sidebar-dimmer">3</div>



      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">안피곤</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v5.4.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.2
  </div>

        




  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-firestore.js"></script>
  <script>
    firebase.initializeApp({
      apiKey: 'AIzaSyA4QZWCWb3IuIHjbkAmO0ttIM2b-qtLTP8',
      projectId: 'next-blog-8f9a0'
    });

    function getCount(doc, increaseCount) {
      // IncreaseCount will be false when not in article page

      return doc.get().then(d => {
        var count = 0;
        if (!d.exists) { // Has no data, initialize count
          if (increaseCount) {
            doc.set({
              count: 1
            });
            count = 1;
          }
        } else { // Has data
          count = d.data().count;
          if (increaseCount) {
            // If first view this article
            doc.set({ // Increase count
              count: count + 1
            });
            count++;
          }
        }

        return count;
      });
    }

    function appendCountTo(el) {
      return count => {
        el.innerText = count;
      }
    }
  </script>
  <script pjax>
    (function() {
      var db = firebase.firestore();
      var articles = db.collection('articles');

      if (CONFIG.page.isPost) { // Is article page
        var title = document.querySelector('.post-title').innerText.trim();
        var doc = articles.doc(title);
        var increaseCount = true;
        if (localStorage.getItem(title)) {
          increaseCount = false;
        } else {
          // Mark as visited
          localStorage.setItem(title, true);
        }
        getCount(doc, increaseCount).then(appendCountTo(document.querySelector('.firestore-visitors-count')));
      } else if (CONFIG.page.isHome) { // Is index page
        var promises = [...document.querySelectorAll('.post-title')].map(element => {
          var title = element.innerText.trim();
          var doc = articles.doc(title);
          return getCount(doc);
        });
        Promise.all(promises).then(counts => {
          var metas = document.querySelectorAll('.firestore-visitors-count');
          counts.forEach((val, idx) => {
            appendCountTo(metas[idx])(val);
          });
        });
      }
    })();
  </script>








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.getAttribute('pjax') !== null) {
      element.setAttribute('pjax', '');
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  



  <script pjax>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id: 21712,
      el: 'wpac-rating',
      color: 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.4.1/dist/instantsearch.min.css">
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.4.1/dist/instantsearch.js"></script>
<script src="/js/algolia-search.js"></script>














    <div id="pjax">

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://anpigon-github-io.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://anpigon.github.io/busy/@anpigon/ethereum-3",
            identifier: "/busy/@anpigon/ethereum-3",
            title: "[블록체인] 이더리움(Ethereum) 공부 #3 - 트랜잭션과 서명"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://anpigon-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    (function() {
      var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        window.addEventListener('load', loadComments, false);
      } else {
        var disqus_scroll = () => {
          // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
          var scrollTop = window.scrollY;

          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            window.removeEventListener('scroll', disqus_scroll);
            loadComments();
          }
        };
        window.addEventListener('scroll', disqus_scroll);
      }
    })();
  
</script>

    </div>
</body>
</html>
