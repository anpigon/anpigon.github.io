---
title: "[Flutter] 플러터(Flutter) 모바일 앱 개발 -  스팀잇 피드 구현하기"
author: anpigon
date: "2018-10-23T16:10:27Z"
permalink: "/dclick/@anpigon/flutter--1540311025725"
tags:
  - "Flutter"
---
안녕하세요. @anpigon 입니다.

이번에는 스팀잇 피드를 가져와서 출력하는 화면을 개발해보았습니다. 이전글 "First Flutter App"에서 추가로 학습할 부분이 거의 없어 코드 설명은 짧게 하였습니다. 그리고 핵심 로직에 집중하기 위해서 UI 컴포넌트는 최소한으로 사용합니다.

---

###### 이전 글

- [모바일 앱 개발 : Flutter 시작하기 #1 - Get started](https://steemit.com/dclick/@anpigon/-flutter--1538895504796)
- [모바일 앱 개발 : Flutter 시작하기 #2 - First Flutter App (1)](https://steemit.com/kr/@anpigon/flutter-2-write-your-first-flutter-app-part-1)
- [모바일 앱 개발 : Flutter 시작하기 #3 - First Flutter App (2)](https://steemit.com/dclick/@anpigon/-flutter-3-write-your-first-flutter-app-part-12-1539616614961)
- [모바일 앱 개발 : Flutter 시작하기 #4 - First Flutter App (3)](https://steemit.com/dclick/@anpigon/-flutter-4-first-flutter-app-3-1539963641589)
- [모바일 앱 개발 : Flutter 시작하기 #5 - First Flutter App (4)](https://steemit.com/@anpigon/-flutter-5-first-flutter-app-4-1540135389352)

---

<br>이번에 완성된 앱의 동작화면입니다. 

![1](https://cdn.steemitimages.com/DQmXmGvV86mfZRSa1mJGqERZUWMLDQo3zpSCgdDyWWyP49Q/Oct-24-2018％2000-58-35.gif)

에뮬레이터 실행 화면이라서 조금 느립니다. 그리고 아직 상세 페이지를 구현하지 않아서 목록을 클릭하면 브라우저가 실행됩니다.

<br><hr><br>

# 외부 패키지 추가

pubspec.yaml 파일을 열고 dependencies 목록에 필요한 패키지(http, url_launcher)를 추가합니다.

```properties
dependencies:
  flutter:
    sdk: flutter

  cupertino_icons: ^0.1.0
  http: ^0.11.3+17        # 패키지 추가
  url_launcher: ^4.0.1    # 패키지 추가
```

<br><hr><br>

# PostList와 Post 클래스 생성

스팀잇에서 Feed 를 가져와서 데이터를 담을 PostList와 Post 모델 클래스를 생성한다.

`model/Post.dart`
```dart
class Post ｛
  final num id;
  final String title;
  final String body;
  final String url;

  Post(｛
    this.id,
    this.title,
    this.body,
    this.url,
  ｝);

  factory Post.fromJson(Map<String, dynamic> json) ｛
    return Post(
      id: json['id'] as num,
      title: json['title'] as String,
      body: json['body'] as String,
      url: json['url'] as String,
    );
  ｝
｝
```
<br>

`model/PostList.dart`

```dart
import 'Post.dart';

class PostList ｛
  final List<Post> result;

  PostList(｛this.result｝);

  factory PostList.fromJson(Map<String, dynamic> json) ｛
    return PostList(
      result: (json['result'] as List)
          ?.map((e) => e == null ? null : new Post.fromJson(e as Map<String, dynamic>))
          ?.toList()
    );
  ｝
｝
```

> JSON 직렬화를 자동으로 할 수도 있다. 자세한 내용은 [JSON and serialization 문서](https://flutter.io/json/)를 참고한다.

<br><hr><br>

# fetchFeedList 함수 구현

fetchFeedList는 [Future](https://docs.flutter.io/flutter/dart-async/Future-class.html)를 async/await와 같이 사용하여 비동기 함수로 구현한다. 참고로 JavaScript(ES7)의 async/await와 동작방식은 같다.

<br>

`Steemit.dart`

```dart
import 'dart:async';    // 비동기
import 'dart:convert';  // JSON 파싱
import 'package:http/http.dart' as http;
import 'package:steemlog/model/PostList.dart';

class Steemit ｛
  /**
   * 스팀잇 피드 리스트를 조회
   */
  Future<PostList> fetchFeedList(String username, int limit) async ｛
    final _url = "https://api.steemit.com";

    final body = '｛"jsonrpc":"2.0", "method":"condenser_api.get_discussions_by_feed", "params":[｛"tag":"$｛username｝","limit":$｛limit
        .toString()｝｝], "id":1｝';
    final response = await http.post(_url, body: body);

    if (response.statusCode == 200) ｛
      // If server returns an OK response, parse the JSON
      return PostList.fromJson(json.decode(response.body));
    ｝ else ｛
      // If that response was not OK, throw an error.
      throw Exception('Failed to load post');
    ｝
  ｝
｝
```

<br><hr><br>

# 화면에 출력하기

이전에 만들었던 첫번째 앱에서 `_buildSuggestions()`와 `_buildRow()` 함수를 수정하자. FutureBuilder의 future를 이용하여 스팀잇 피드를 비동기로 가져온다. 만약 future가 완료되지 않았다면 `CircularProgressIndicator()`를 사용하여 프로그래스 이미지를 보여준다.

```dart
import 'package:url_launcher/url_launcher.dart';
import 'package:steemlog/model/Post.dart';
import 'package:steemlog/model/PostList.dart';
import 'package:steemlog/Steemit.dart';

  // ... 생략 ...

class FeedListState extends State<FeedList> ｛
  final String _username = 'anpigon'; // 사용자 이름
  final int _limit = 20; // 가져올 피드 개수

  @override
  Widget build(BuildContext context) ｛
    return new Scaffold(
        appBar: new AppBar(
          title: new Text('Feed List'),
        ),
        body: _buildSuggestions()
    );
  ｝

  Widget _buildSuggestions() ｛
    return new Center(
        child: FutureBuilder<PostList>(
            future: Steemit().fetchFeedList(_username, _limit),
            builder: (context, post) ｛
              if (post.hasData) ｛
                return new ListView.builder(
                  padding: const EdgeInsets.all(5.0),
                  itemCount: post.data.result.length,
                  itemBuilder: (BuildContext _context, int position) ｛
                    return _buildRow(post.data.result[position]);
                  ｝,
                );
              ｝ else if (post.hasError) ｛
                return Text("$｛post.error｝");
              ｝
              return CircularProgressIndicator();
            ｝
        )
    );
  ｝

  Widget _buildRow(Post post) ｛
    return new Column(
      children: <Widget>[
        new ListTile(
          title: new Text(post.title),
          subtitle: new Text(post.body,
            overflow: TextOverflow.ellipsis,
            maxLines: 3
          ),
          onTap: () ｛
            _launchURL(post.url);
          ｝,
        ),
        const Divider()
      ]
    );
  ｝

  _launchURL(String _url) async ｛
    final String url = "https://steemit.com$｛_url｝";
    if (await canLaunch(url)) ｛
      await launch(url);
    ｝ else ｛
      throw 'Could not launch $url';
    ｝
  ｝
｝
```

[Text](https://docs.flutter.io/flutter/widgets/Text-class.html)에서 제공하는 `overflow` 속성을 사용하여 내용을 최대 3줄만 표시되도록 했다.

<br><hr><br>

여기서 작성한 코드는 모두 깃허브에 올려놓았습니다.
- [https://github.com/anpigon/flutter-steemit-app](https://github.com/anpigon/flutter-steemit-app)

<br>여기까지 읽어주셔서 감사합니다.

<br>

***
#####  <sub> **Sponsored ( Powered by [dclick](https://www.dclick.io) )** </sub>
##### [드디어 이지 스팀잇이 출간되었습니다(+M-shape도요~)](https://api.dclick.io/v1/c?x=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjIjoiYW5waWdvbiIsInMiOiJmbHV0dGVyLS0xNTQwMzExMDI1NzI1IiwiYSI6WzE5MV0sInVybCI6Imh0dHBzOi8vc3RlZW1pdC5jb20va3IvQGZvcmhhcHB5d29tZW4vbS1zaGFwZS10ZXl1eHZ6dmR1IiwiaWF0IjoxNTQwMzExMDI1LCJleHAiOjE4NTU2NzEwMjV9.zJKrPhja-xQ6ztMJOoAukhT9upaCOIPAfnHZi7JNFp8)
<sup>안녕하세요. 포해피우먼입니다. 오늘은 반가운 소식을 가지고 왔습니다. 아기다리고기다리 (-_-...</sup>
<br><center>![logo](https://steemitimages.com/200x100/https://cdn.steemitimages.com/DQmbjkrc5UT4GgZXygAnS3mLrboAy7Y8gr7R7guB8HG3f5n/logopad500.png)<br><br>이 글은 스팀 기반 광고 플랫폼<br>[dclick](https://www.dclick.io) 에 의해 작성 되었습니다.</center>